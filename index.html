<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hybrid Simulation Modelling Lab (HSML) MIDCARE© University Hospital Limerick (UHL) Over 75 Admissions Interactive Dashboard</title>
  <style>
    :root{--bg:#0b1020;--panel:#11172b;--ink:#e7eefc;--muted:#a9b4cc;--grid:#223055;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;background:var(--bg);color:var(--ink)}
    header{padding:18px 22px;border-bottom:1px solid var(--grid);background:linear-gradient(180deg,#0c1328,#0b1020)}
    h1{margin:0;font-size:18px;letter-spacing:.2px;display:flex;align-items:center;gap:10px}
    .wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
    @media (max-width:1000px){.wrap{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid var(--grid);border-radius:14px;padding:14px}
    .group{margin-bottom:14px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:8px}
    input[type="number"],input[type="text"],select{width:100%;padding:8px 10px;border-radius:8px;border:1px solid var(--grid);background:#0c1426;color:var(--ink)}
    input[type="range"]{width:100%}
    .kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
    @media (max-width:1200px){.kpis{grid-template-columns:repeat(2,1fr)}}
    .kpi{padding:10px;border-radius:12px;background:#0e1730;border:1px solid var(--grid)}
    .kpi .label{font-size:12px;color:var(--muted)}
    .kpi .val{font-size:18px;margin-top:6px}
    .charts{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:1200px){.charts{grid-template-columns:1fr}}
    .plot.card{padding:8px 10px}
    .plot h3{margin:4px 0 10px;font-size:14px;color:var(--ink)}
    button,a.btn{cursor:pointer;border:1px solid var(--grid);background:#122042;color:var(--ink);padding:9px 12px;border-radius:10px;text-decoration:none}
    button:hover,a.btn:hover{background:#162a54}
    .footer{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    details.note{margin:18px 22px;color:var(--muted)}
    details.note summary{color:var(--ink);cursor:pointer}
    .note pre{white-space:pre-wrap}
  </style>
</head>
<body>
  <header>
    <h1>
      <img
        alt="HSML Logo"
        style="height:40px"
        src="data:image/png;base64,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" />
      Hybrid Simulation Modelling Lab (HSML) MIDCARE© University Hospital Limerick (UHL) Over 75 Admissions Interactive Dashboard
    </h1>
  </header>

  <div class="wrap">
    <!-- SIDEBAR -->
    <aside class="card">
      <div class="group">
        <label>Initial population ≥75 (people)</label>
        <input id="initial_pop" type="number" min="0" max="100000" value="30000" step="100">
      </div>
      <div class="group">

<label>Annual net growth rate (≥75): <span id="growth_rate_val">0.05</span></label>
<input id="growth_rate" type="range" min="-0.02" max="0.10" value="0.05" step="0.001">

        
      </div>
      <div class="group">
        <label>Annual mortality/discharge rate (≥75): <span id="mortality_rate_val">0.05</span></label>
        <input id="mortality_rate" type="range" min="0.03" max="0.10" value="0.05" step="0.001">
      </div>
      <div class="group">
        <label>ED attendance rate (per 1,000 per year): <span id="ed_rate_val">900</span></label>
        <input id="ed_rate" type="range" min="500" max="1500" value="700" step="10">
      </div>
      <div class="group">
        <label>Admission rate from ED (≥75): <span id="admission_rate_val">0.55</span></label>
        <input id="admission_rate" type="range" min="0.40" max="0.70" value="0.55" step="0.01">
      </div>
      <div class="group">
        <label>Mean length of stay (days): <span id="los_days_val">6.5</span></label>
        <input id="los_days" type="range" min="4" max="10" value="6.5" step="0.1">
      </div>
      <div class="group">
        <label>Unit cost per admission (€)</label>
        <input id="unit_cost" type="number" min="0" max="10000" step="100" value="5800">
      </div>

      <div class="group" style="display:flex;gap:8px">
        <div style="flex:1"><label>Start year</label><input id="start_year" type="number" value="2015" step="1"></div>
        <div style="flex:1"><label>End year</label><input id="end_year" type="number" value="2050" step="1"></div>
      </div>
      <div class="group"><label>Time step (years)</label>
        <select id="dt"><option value="0.25" selected>0.25</option><option value="0.5">0.5</option><option value="1">1.0</option></select>
      </div>
      <div class="group"><label>Price year label</label><input id="price_year" type="text" value="Specify (e.g., 2024 €)"></div>

      <div class="footer">
        <button id="run">Run</button>
        <button id="reset">Reset</button>
        <a id="download_csv" class="btn" href="#" download="age75_dashboard_results.csv">Download CSV</a>
        <a id="download_html" class="btn" href="#" download="age75_dashboard.html">Download this HTML</a>
      </div>
      <div class="group"><label><input id="autoupd" type="checkbox" checked> Auto-update on change</label></div>
    </aside>

    <!-- MAIN -->
    <main class="card">
      <div class="kpis">
        <div class="kpi"><div class="label">Population ≥75 (final)</div><div id="kpi_pop" class="val">—</div></div>
        <div class="kpi"><div class="label">ED attendances / yr (final)</div><div id="kpi_att" class="val">—</div></div>
        <div class="kpi"><div class="label">Admissions / yr (final)</div><div id="kpi_adm" class="val">—</div></div>
        <div class="kpi"><div class="label">Bed-days / yr (final)</div><div id="kpi_bd" class="val">—</div></div>
        <div class="kpi"><div class="label">Total cost / yr (final)</div><div id="kpi_cost" class="val">—</div></div>
      </div>

      <div class="charts" style="margin-top:12px">
        <div class="plot card"><h3>Population ≥75</h3>
          <svg id="svg_pop" class="chart" width="900" height="340" viewBox="0 0 900 340" preserveAspectRatio="none"
               style="width:100% !important; height:340px !important; display:block !important; background:#0a1125; border-radius:10px;"></svg>
        </div>
        <div class="plot card"><h3>ED Attendances per year</h3>
          <svg id="svg_att" class="chart" width="900" height="340" viewBox="0 0 900 340" preserveAspectRatio="none"
               style="width:100% !important; height:340px !important; display:block !important; background:#0a1125; border-radius:10px;"></svg>
        </div>
        <div class="plot card"><h3>Admissions per year</h3>
          <svg id="svg_adm" class="chart" width="900" height="340" viewBox="0 0 900 340" preserveAspectRatio="none"
               style="width:100% !important; height:340px !important; display:block !important; background:#0a1125; border-radius:10px;"></svg>
        </div>
        <div class="plot card"><h3>Average Daily Occupied Beds</h3>
          <svg id="svg_avgbed" class="chart" width="900" height="340" viewBox="0 0 900 340" preserveAspectRatio="none"
               style="width:100% !important; height:340px !important; display:block !important; background:#0a1125; border-radius:10px;"></svg>
        </div>
        <div class="plot card"><h3>Bed-days per year</h3>
          <svg id="svg_bd" class="chart" width="900" height="340" viewBox="0 0 900 340" preserveAspectRatio="none"
               style="width:100% !important; height:340px !important; display:block !important; background:#0a1125; border-radius:10px;"></svg>
        </div>
        <div class="plot card"><h3>Total cost per year (<span id="price_lbl"></span>)</h3>
          <svg id="svg_cost" class="chart" width="900" height="340" viewBox="0 0 900 340" preserveAspectRatio="none"
               style="width:100% !important; height:340px !important; display:block !important; background:#0a1125; border-radius:10px;"></svg>
        </div>
      </div>
    </main>
  </div>

  <details class="note">
    <summary>Rationale & Data Sources</summary>
    <pre>
This dashboard uses parameter values updated to reflect current real-world data for the ≥75 population in the HSE Mid-West (University Hospital Limerick region).

Parameter                 | Suggested Value | Rationale / Source
------------------------- | --------------- | ------------------------------------------------------------
Population ≥75            | ~30,000         | Census 2022 shows ~33,600 (65+) in Limerick alone; Midwest region (Clare, Limerick, N. Tipperary) likely has even more. (CSO, HSE.ie, Nenagh Guardian)
Annual net growth rate    | 0.00%           | Aging population growth has stabilised; conservative baseline used unless projection data suggest otherwise.
Mortality/discharge rate  | 5% (3–10%)      | Typical annual attrition for ≥75 cohort; allows flexibility in modeling.
ED attendance rate        | 900 / 1,000/yr  | Nationally, ~15% of ED attendances are ≥75; with ~80,000 ED visits in the Mid-West in 2023, this group likely exceeds 600/1,000. Mid-range 900/1,000 chosen. (HSE, IHCA)
Admission rate from ED    | 55%             | National data show ~52% of ≥75 attenders admitted; 55% used as realistic midpoint. (Dental Health Foundation, Drugs & Alcohol reports)
Mean Length of Stay (LOS) | 6.5 days        | National ALOS for emergency inpatients ~6.3 days pre-pandemic; ≥75 patients typically a little longer. (HSE.ie)
Unit cost per admission   | €5,800          | Based on per euro cost of ~€834/day × 7 days = ~€5,800. (HSE costing data)
    </pre>
  </details>

  <script>
  (function(){
    const q = (id)=>document.getElementById(id);
    const fmt0 = (n)=>Number(n).toLocaleString();

    function readParams(){
      let start = parseFloat(q("start_year").value);
      let end   = parseFloat(q("end_year").value);
      if(end < start){ end = start; q("end_year").value = end; }
      return {
        initial_pop: parseFloat(q("initial_pop").value),
        growth_rate: parseFloat(q("growth_rate").value),
        mortality_rate: parseFloat(q("mortality_rate").value),
        ed_rate_per_1000: parseFloat(q("ed_rate").value),
        admission_rate: parseFloat(q("admission_rate").value),
        los_days: parseFloat(q("los_days").value),
        unit_cost_eur: parseFloat(q("unit_cost").value),
        start_year: start, end_year: end, dt: parseFloat(q("dt").value),
        price_year: q("price_year").value
      };
    }

    // Population first; flows computed at each point (prevents t0 spike)
    function simulate(p){
      const t=[]; for(let x=p.start_year; x<=p.end_year+1e-9; x+=p.dt){ t.push(Number(x.toFixed(10))); }
      const n=t.length;
      const pop=Array(n).fill(0), attend=Array(n).fill(0), adm=Array(n).fill(0), bd=Array(n).fill(0), cost=Array(n).fill(0), cum=Array(n).fill(0), avgbed=Array(n).fill(0);

      pop[0]=p.initial_pop;
      for(let i=1;i<n;i++){
        const inflow  = p.growth_rate    * pop[i-1];
        const outflow = p.mortality_rate * pop[i-1];
        pop[i] = Math.max(0, pop[i-1] + (inflow - outflow) * p.dt);
      }
      for(let i=0;i<n;i++){
        const a = pop[i] * (p.ed_rate_per_1000 / 1000.0);
        const m = a * p.admission_rate;
        attend[i]=a; adm[i]=m; bd[i]=m*p.los_days; cost[i]=m*p.unit_cost_eur;
        avgbed[i]=bd[i]/365.0;
        cum[i] = (i===0?0:cum[i-1] + m*p.dt);
      }
      return {t,pop,attend,adm,bd,cost,cum,avgbed};
    }

    // SVG line chart
    function lineChart(svg, series){
      const W = Number(svg.getAttribute('width'))  || 900;
      const H = Number(svg.getAttribute('height')) || 340;
      svg.setAttribute('viewBox', `0 0 ${W} ${H}`);
      svg.innerHTML='';

      const m={t:14,r:16,b:28,l:44}, w=W-m.l-m.r, h=H-m.t-m.b;
      const t=series.t, y=series.y;
      const minX=Math.min(...t), maxX=Math.max(...t);
      const minY=Math.min(...y), maxY=Math.max(...y);
      const x=(v)=>m.l + (w*(v-minX))/( (maxX-minX) || 1 );
      const ypx=(v)=>m.t + h - (h*(v-minY))/( (maxY-minY) || 1 );

      const NS='http://www.w3.org/2000/svg';
      const line=(attrs)=>{ const el=document.createElementNS(NS,'line'); for(const k in attrs) el.setAttribute(k,attrs[k]); return el; };
      const text=(attrs,txt)=>{ const el=document.createElementNS(NS,'text'); for(const k in attrs) el.setAttribute(k,attrs[k]); el.textContent=txt; return el; };
      const path=(d)=>{ const el=document.createElementNS(NS,'path'); el.setAttribute('d',d); el.setAttribute('fill','none'); el.setAttribute('stroke','#6aa4ff'); el.setAttribute('stroke-width','2'); return el; };

      svg.appendChild(line({x1:m.l,y1:H-m.b,x2:W-m.r,y2:H-m.b,stroke:'#2a3a66','stroke-width':1}));
      svg.appendChild(line({x1:m.l,y1:m.t,x2:m.l,y2:H-m.b,stroke:'#2a3a66','stroke-width':1}));

      for(let i=0;i<=5;i++){
        const xt=minX + (i*(maxX-minX))/5, lx=x(xt), ly=H-m.b;
        svg.appendChild(line({x1:lx,y1:ly,x2:lx,y2:ly+4,stroke:'#2a3a66','stroke-width':1}));
        svg.appendChild(line({x1:lx,y1:m.t,x2:lx,y2:ly,stroke:'#1a274a','stroke-width':1,opacity:.3}));
        svg.appendChild(text({x:lx,y:ly+16,fill:'#a9b4cc','font-size':10,'text-anchor':'middle'}, Math.round(xt)));
      }
      for(let i=0;i<=5;i++){
        const yt=minY + (i*(maxY-minY))/5, ly=ypx(yt);
        svg.appendChild(line({x1:m.l-4,y1:ly,x2:m.l,y2:ly,stroke:'#2a3a66','stroke-width':1}));
        svg.appendChild(line({x1:m.l,y1:ly,x2:W-m.r,y2:ly,stroke:'#1a274a','stroke-width':1,opacity:.3}));
        svg.appendChild(text({x:m.l-6,y:ly+3,fill:'#a9b4cc','font-size':10,'text-anchor':'end'}, (Math.round(yt*100)/100).toLocaleString()));
      }

      let d=''; for(let i=0;i<t.length;i++){ const px=x(t[i]), py=ypx(y[i]); d += (i?` L ${px} ${py}`:`M ${px} ${py}`); }
      svg.appendChild(path(d));
    }

    function toCSV(p,sim){
      const cols=["Year","Population_75plus","ED_Attendances_75plus_per_year","Admissions_75plus_per_year","Avg_Daily_Occupied_Beds_75plus","Bed_Days_75plus_per_year","Total_Cost_75plus_per_year"];
      const rows=[cols.join(",")];
      for(let i=0;i<sim.t.length;i++) rows.push([
        sim.t[i],sim.pop[i],sim.attend[i],sim.adm[i],sim.avgbed[i],sim.bd[i],sim.cost[i]
      ].join(","));
      return rows.join("\n");
    }

    function updateKpis(sim){
      const i=sim.t.length-1;
      q("kpi_pop").textContent  = fmt0(sim.pop[i]);
      q("kpi_att").textContent  = fmt0(sim.attend[i]);
      q("kpi_adm").textContent  = fmt0(sim.adm[i]);
      q("kpi_bd").textContent   = fmt0(sim.bd[i]);
      q("kpi_cost").textContent = "€ "+fmt0(sim.cost[i]);
    }

    function recalc(){
      const p=readParams(); q("price_lbl").textContent=p.price_year;
      const sim=simulate(p);
      lineChart(q("svg_pop"),  {t:sim.t,y:sim.pop});
      lineChart(q("svg_att"),  {t:sim.t,y:sim.attend});
      lineChart(q("svg_adm"),  {t:sim.t,y:sim.adm});
      lineChart(q("svg_avgbed"),{t:sim.t,y:sim.avgbed});
      lineChart(q("svg_bd"),   {t:sim.t,y:sim.bd});
      lineChart(q("svg_cost"), {t:sim.t,y:sim.cost});
      updateKpis(sim);

      const csv=toCSV(p,sim);
      const url=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
      q("download_csv").href=url;

      // Allow downloading the exact HTML as currently displayed
      const blobHTML = new Blob([document.documentElement.outerHTML], {type:"text/html"});
      q("download_html").href = URL.createObjectURL(blobHTML);
    }

    // Bind inputs
    const inputs = ["initial_pop","growth_rate","mortality_rate","ed_rate","admission_rate","los_days","unit_cost","start_year","end_year","dt","price_year"];
    function bind(){
      inputs.forEach(id=>{
        q(id).addEventListener("input",()=>{
          if(!q("autoupd").checked) return;
          if(id==="growth_rate") q("growth_rate_val").textContent=q(id).value;
          if(id==="mortality_rate") q("mortality_rate_val").textContent=q(id).value;
          if(id==="ed_rate") q("ed_rate_val").textContent=q(id).value;
          if(id==="admission_rate") q("admission_rate_val").textContent=q(id).value;
          if(id==="los_days") q("los_days_val").textContent=q(id).value;
          recalc();
        });
      });
      q("run").addEventListener("click", ()=>recalc());

      // Reset to UPDATED defaults
      q("reset").addEventListener("click", ()=>{
        q("initial_pop").value=30000;
        q("growth_rate").value=0.00; q("growth_rate_val").textContent="0.00";
        q("mortality_rate").value=0.05; q("mortality_rate_val").textContent="0.05";
        q("ed_rate").value=900; q("ed_rate_val").textContent="900";
        q("admission_rate").value=0.55; q("admission_rate_val").textContent="0.55";
        q("los_days").value=6.5; q("los_days_val").textContent="6.5";
        q("unit_cost").value=5800;
        q("start_year").value=2015; q("end_year").value=2050; q("dt").value=0.25; q("price_year").value="Specify (e.g., 2024 €)";
        recalc();
      });

      // Keyboard shortcut: R to run
      window.addEventListener("keydown", (e)=>{ if(e.key.toLowerCase()==="r") recalc(); });
      window.addEventListener("resize", recalc);
    }

    bind();
    recalc();
  })();
  </script>
</body>
</html>





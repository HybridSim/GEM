<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>>=75 Admissions – Interactive Dashboard (No libs)</title>
<style>
  :root{--bg:#0b1020;--panel:#11172b;--ink:#e7eefc;--muted:#a9b4cc;--grid:#223055;}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;background:var(--bg);color:var(--ink)}
  header{padding:18px 22px;border-bottom:1px solid var(--grid);background:linear-gradient(180deg,#0c1328,#0b1020)}
  h1{margin:0;font-size:18px;letter-spacing:.2px}
  .wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
  @media (max-width:1000px){.wrap{grid-template-columns:1fr}}
  .card{background:var(--panel);border:1px solid var(--grid);border-radius:14px;padding:14px}
  .group{margin-bottom:14px}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:8px}
  input[type="number"],input[type="text"],select{
    width:100%;padding:8px 10px;border-radius:8px;border:1px solid var(--grid);background:#0c1426;color:var(--ink)
  }
  input[type="range"]{width:100%}
  .small{font-size:12px;color:var(--muted)}
  .kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
  @media (max-width:1200px){.kpis{grid-template-columns:repeat(2,1fr)}}
  .kpi{padding:10px;border-radius:12px;background:#0e1730;border:1px solid var(--grid)}
  .kpi .label{font-size:12px;color:var(--muted)}
  .kpi .val{font-size:18px;margin-top:6px}
  .charts{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:1200px){.charts{grid-template-columns:1fr}}
  .plot.card{padding:8px 10px}
  .plot h3{margin:4px 0 10px;font-size:14px;color:var(--ink)}
  svg{width:100%;height:300px;display:block;background:#0a1125;border-radius:10px}
  button,a.btn{cursor:pointer;border:1px solid var(--grid);background:#122042;color:var(--ink);padding:9px 12px;border-radius:10px;text-decoration:none}
  button:hover,a.btn:hover{background:#162a54}
  .footer{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .params{white-space:pre;font-family:ui-monospace,Consolas,monospace;font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<header><h1>>=75 Admissions – System Dynamics Dashboard (Pure HTML/JS/SVG)</h1></header>

<div class="wrap">
  <!-- SIDEBAR -->
  <aside class="card">
    <div class="group">
      <label>Initial population >=75 (people)</label>
      <input id="initial_pop" type="number" min="0" max="500000" value="11500" step="100">
    </div>
    <div class="group">
      <label>Annual net growth rate (>=75): <span id="growth_rate_val" class="small">0.02</span></label>
      <input id="growth_rate" type="range" min="-0.05" max="0.08" value="0.02" step="0.001">
    </div>
    <div class="group">
      <label>Annual mortality/discharge rate (>=75): <span id="mortality_rate_val" class="small">0.05</span></label>
      <input id="mortality_rate" type="range" min="0" max="0.2" value="0.05" step="0.001">
    </div>
    <div class="group">
      <label>ED attendance rate (per 1,000 per year): <span id="ed_rate_val" class="small">600</span></label>
      <input id="ed_rate" type="range" min="0" max="2000" value="600" step="10">
    </div>
    <div class="group">
      <label>Admission rate from ED (>=75): <span id="admission_rate_val" class="small">0.68</span></label>
      <input id="admission_rate" type="range" min="0" max="1" value="0.68" step="0.01">
    </div>
    <div class="group">
      <label>Mean length of stay (days): <span id="los_days_val" class="small">7</span></label>
      <input id="los_days" type="range" min="0" max="30" value="7" step="0.1">
    </div>
    <div class="group">
      <label>Unit cost per admission (€)</label>
      <input id="unit_cost" type="number" min="0" max="100000" step="100" value="5500">
    </div>
    <div class="group" style="display:flex;gap:8px">
      <div style="flex:1">
        <label>Start year</label>
        <input id="start_year" type="number" value="2015" step="1">
      </div>
      <div style="flex:1">
        <label>End year</label>
        <input id="end_year" type="number" value="2050" step="1">
      </div>
    </div>
    <div class="group">
      <label>Time step (years)</label>
      <select id="dt">
        <option value="0.25" selected>0.25</option>
        <option value="0.5">0.5</option>
        <option value="1">1.0</option>
      </select>
    </div>
    <div class="group">
      <label>Price year label</label>
      <input id="price_year" type="text" value="Specify (e.g., 2024 €)">
    </div>
    <div class="footer">
      <button id="reset">Reset defaults</button>
      <a id="download_csv" class="btn" href="#" download="age75_dashboard_results.csv">Download CSV</a>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="card">
    <div class="kpis">
      <div class="kpi"><div class="label">Population >=75 (final)</div><div id="kpi_pop" class="val">—</div></div>
      <div class="kpi"><div class="label">ED attendances / yr (final)</div><div id="kpi_att" class="val">—</div></div>
      <div class="kpi"><div class="label">Admissions / yr (final)</div><div id="kpi_adm" class="val">—</div></div>
      <div class="kpi"><div class="label">Bed-days / yr (final)</div><div id="kpi_bd" class="val">—</div></div>
      <div class="kpi"><div class="label">Total cost / yr (final)</div><div id="kpi_cost" class="val">—</div></div>
    </div>

    <div class="charts" style="margin-top:12px">
      <div class="plot card"><h3>Population >=75</h3><svg id="svg_pop"></svg></div>
      <div class="plot card"><h3>ED Attendances per year</h3><svg id="svg_att"></svg></div>
      <div class="plot card"><h3>Admissions per year</h3><svg id="svg_adm"></svg></div>
      <div class="plot card"><h3>Cumulative admissions</h3><svg id="svg_cum"></svg></div>
      <div class="plot card"><h3>Bed-days per year</h3><svg id="svg_bd"></svg></div>
      <div class="plot card"><h3>Total cost per year (<span id="price_lbl"></span>)</h3><svg id="svg_cost"></svg></div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="small">Current parameter set (for reproducibility):</div>
      <pre id="param_dump" class="params"></pre>
    </div>
  </main>
</div>

<script>
(function(){
  const q = (id)=>document.getElementById(id);
  const fmt0 = (n)=>Number(n).toLocaleString();

  function readParams(){
    let start = parseFloat(q("start_year").value);
    let end   = parseFloat(q("end_year").value);
    if(end < start){ end = start; q("end_year").value = end; }
    return {
      initial_pop: parseFloat(q("initial_pop").value),
      growth_rate: parseFloat(q("growth_rate").value),
      mortality_rate: parseFloat(q("mortality_rate").value),
      ed_rate_per_1000: parseFloat(q("ed_rate").value),
      admission_rate: parseFloat(q("admission_rate").value),
      los_days: parseFloat(q("los_days").value),
      unit_cost_eur: parseFloat(q("unit_cost").value),
      start_year: start,
      end_year: end,
      dt: parseFloat(q("dt").value),
      price_year: q("price_year").value
    };
  }

  function simulate(p){
    const t=[]; for(let x=p.start_year; x<=p.end_year+1e-9; x+=p.dt){ t.push(Number(x.toFixed(10))); }
    const n=t.length, pop=Array(n).fill(0), attend=Array(n).fill(0), adm=Array(n).fill(0), bd=Array(n).fill(0), cost=Array(n).fill(0), cum=Array(n).fill(0);
    pop[0]=p.initial_pop;
    for(let i=1;i<n;i++){
      const inflow = p.growth_rate * pop[i-1];
      const outflow= p.mortality_rate * pop[i-1];
      pop[i]=Math.max(0, pop[i-1] + (inflow - outflow)*p.dt);
      const a = pop[i-1]*(p.ed_rate_per_1000/1000.0);
      const m = a*p.admission_rate;
      attend[i]=a; adm[i]=m; bd[i]=m*p.los_days; cost[i]=m*p.unit_cost_eur; cum[i]=cum[i-1]+m*p.dt;
    }
    return {t,pop,attend,adm,bd,cost,cum};
  }

  // --- Minimal SVG line chart (no libs)
  function lineChart(svg, series, options){
    const W=svg.clientWidth||svg.parentElement.clientWidth||600, H=svg.clientHeight||300;
    const m = {t:14,r:16,b:28,l:44};
    const w=W-m.l-m.r, h=H-m.t-m.b;
    const t=series.t, y=series.y;
    const minX=Math.min(...t), maxX=Math.max(...t);
    const minY=Math.min(...y), maxY=Math.max(...y);
    const x=(v)=>m.l + (w*(v-minX))/(maxX-minX || 1);
    const ypx=(v)=>m.t + h - (h*(v-minY))/(maxY-minY || 1);

    svg.setAttribute("viewBox",`0 0 ${W} ${H}`);
    svg.innerHTML="";

    // axes
    const gAxis = document.createElementNS("http://www.w3.org/2000/svg","g");
    const axisStyle="stroke:#2a3a66;stroke-width:1";
    const gridStyle="stroke:#1a274a;stroke-width:1";
    // x axis
    const xaxis=document.createElementNS(svg.namespaceURI,"line");
    xaxis.setAttribute("x1",m.l); xaxis.setAttribute("y1",H-m.b);
    xaxis.setAttribute("x2",W-m.r); xaxis.setAttribute("y2",H-m.b);
    xaxis.setAttribute("style",axisStyle); gAxis.appendChild(xaxis);
    // y axis
    const yaxis=document.createElementNS(svg.namespaceURI,"line");
    yaxis.setAttribute("x1",m.l); yaxis.setAttribute("y1",m.t);
    yaxis.setAttribute("x2",m.l); yaxis.setAttribute("y2",H-m.b);
    yaxis.setAttribute("style",axisStyle); gAxis.appendChild(yaxis);

    // ticks (5)
    for(let i=0;i<=5;i++){
      const xt=minX + (i*(maxX-minX))/5;
      const lx=x(xt), ly=H-m.b;
      const tick=document.createElementNS(svg.namespaceURI,"line");
      tick.setAttribute("x1",lx); tick.setAttribute("y1",ly);
      tick.setAttribute("x2",lx); tick.setAttribute("y2",ly+4);
      tick.setAttribute("style",axisStyle);
      gAxis.appendChild(tick);

      const grid=document.createElementNS(svg.namespaceURI,"line");
      grid.setAttribute("x1",lx); grid.setAttribute("y1",m.t);
      grid.setAttribute("x2",lx); grid.setAttribute("y2",H-m.b);
      grid.setAttribute("style",gridStyle);
      grid.setAttribute("opacity",".3");
      gAxis.appendChild(grid);

      const lbl=document.createElementNS(svg.namespaceURI,"text");
      lbl.setAttribute("x",lx); lbl.setAttribute("y",ly+16);
      lbl.setAttribute("fill","#a9b4cc"); lbl.setAttribute("font-size","10");
      lbl.setAttribute("text-anchor","middle");
      lbl.textContent=Math.round(xt);
      gAxis.appendChild(lbl);
    }
    for(let i=0;i<=5;i++){
      const yt=minY + (i*(maxY-minY))/5;
      const ly=ypx(yt);
      const tick=document.createElementNS(svg.namespaceURI,"line");
      tick.setAttribute("x1",m.l-4); tick.setAttribute("y1",ly);
      tick.setAttribute("x2",m.l); tick.setAttribute("y2",ly);
      tick.setAttribute("style",axisStyle);
      gAxis.appendChild(tick);

      const grid=document.createElementNS(svg.namespaceURI,"line");
      grid.setAttribute("x1",m.l); grid.setAttribute("y1",ly);
      grid.setAttribute("x2",W-m.r); grid.setAttribute("y2",ly);
      grid.setAttribute("style",gridStyle);
      grid.setAttribute("opacity",".3");
      gAxis.appendChild(grid);

      const lbl=document.createElementNS(svg.namespaceURI,"text");
      lbl.setAttribute("x",m.l-6); lbl.setAttribute("y",ly+3);
      lbl.setAttribute("fill","#a9b4cc"); lbl.setAttribute("font-size","10");
      lbl.setAttribute("text-anchor","end");
      lbl.textContent=(Math.round(yt*100)/100).toLocaleString();
      gAxis.appendChild(lbl);
    }
    svg.appendChild(gAxis);

    // line
    const path=document.createElementNS(svg.namespaceURI,"path");
    let d="";
    for(let i=0;i<t.length;i++){
      const px=x(t[i]), py=ypx(y[i]);
      d += (i===0?`M ${px} ${py}`:` L ${px} ${py}`);
    }
    path.setAttribute("d",d);
    path.setAttribute("fill","none");
    path.setAttribute("stroke","#6aa4ff");
    path.setAttribute("stroke-width","2");
    svg.appendChild(path);
  }

  function toCSV(p, sim){
    const header = [
      "Year","Population_75plus",
      "ED_Attendances_75plus_per_year","Admissions_75plus_per_year",
      "Bed_Days_75plus_per_year","Total_Cost_75plus_per_year",
      "Cumulative_Admissions_75plus"
    ].join(",");
    const rows=[header];
    for(let i=0;i<sim.t.length;i++){
      rows.push([
        sim.t[i], sim.pop[i], sim.attend[i], sim.adm[i],
        sim.bd[i], sim.cost[i], sim.cum[i]
      ].join(","));
    }
    return rows.join("\n");
  }

  function dumpParams(p){ q("param_dump").textContent = JSON.stringify(p,null,2); }
  function updateKpis(sim){
    const i=sim.t.length-1;
    q("kpi_pop").textContent  = fmt0(sim.pop[i]);
    q("kpi_att").textContent  = fmt0(sim.attend[i]);
    q("kpi_adm").textContent  = fmt0(sim.adm[i]);
    q("kpi_bd").textContent   = fmt0(sim.bd[i]);
    q("kpi_cost").textContent = "€ " + fmt0(sim.cost[i]);
  }

  function recalc(){
    const p=readParams(); q("price_lbl").textContent=p.price_year;
    const sim=simulate(p);

    // Draw charts
    lineChart(q("svg_pop"), {t:sim.t, y:sim.pop});
    lineChart(q("svg_att"), {t:sim.t, y:sim.attend});
    lineChart(q("svg_adm"), {t:sim.t, y:sim.adm});
    lineChart(q("svg_cum"), {t:sim.t, y:sim.cum});
    lineChart(q("svg_bd"),  {t:sim.t, y:sim.bd});
    lineChart(q("svg_cost"),{t:sim.t, y:sim.cost});

    // KPI + params
    updateKpis(sim);
    dumpParams(p);

    // CSV download
    const csv = toCSV(p, sim);
    const url = URL.createObjectURL(new Blob([csv], {type:"text/csv"}));
    q("download_csv").href = url;
  }

  // Bind inputs
  ["initial_pop","growth_rate","mortality_rate","ed_rate","admission_rate","los_days","unit_cost","start_year","end_year","dt","price_year"].forEach(id=>{
    q(id).addEventListener("input",()=>{
      if(id==="growth_rate") q("growth_rate_val").textContent=q(id).value;
      if(id==="mortality_rate") q("mortality_rate_val").textContent=q(id).value;
      if(id==="ed_rate") q("ed_rate_val").textContent=q(id).value;
      if(id==="admission_rate") q("admission_rate_val").textContent=q(id).value;
      if(id==="los_days") q("los_days_val").textContent=q(id).value;
      recalc();
    });
  });

  q("reset").addEventListener("click",()=>{
    q("initial_pop").value=11500; q("growth_rate").value=0.02; q("growth_rate_val").textContent="0.02";
    q("mortality_rate").value=0.05; q("mortality_rate_val").textContent="0.05";
    q("ed_rate").value=600; q("ed_rate_val").textContent="600";
    q("admission_rate").value=0.68; q("admission_rate_val").textContent="0.68";
    q("los_days").value=7; q("los_days_val").textContent="7";
    q("unit_cost").value=5500; q("start_year").value=2015; q("end_year").value=2050; q("dt").value=0.25; q("price_year").value="Specify (e.g., 2024 €)";
    recalc();
  });

  // Initial draw
  recalc();

  // Redraw on resize so SVG uses full width
  window.addEventListener("resize", recalc);
})();
</script>
</body>
</html>


